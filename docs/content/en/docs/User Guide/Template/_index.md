---
categories: []
tags: ["feature", "extensions"] 
title: "Template"
linkTitle: "Template"
weight: 40
description: >
  Learn how to use templating to dynamically build resource specification files for Jikkou.
---


## Template Engine

Jikkou provides a simple templating mechanism based-on [Jinjava](https://github.com/HubSpot/jinjava), a Jinja template engine for Java.
Basically, templating helps you to reuse the same _resource specification files_ for multiple Apache Kafka environments by dynamically generating resource specifications and/or config properties from external data.

Read the official documentation of [Jinja](https://jinja.palletsprojects.com/en/3.1.x/templates/#base-template) to learn more about the syntax and semantics of the template engine.

## How Does It Work ?

Jikkou performs the rendering of your template in two phases: 

1. First, an initial rendering is performed using only the `values` and `labels` passed through the command-lines arguments. 
   * Thus, it is perfectly OK if your resource file is not initially a valid YAML file.
2. Then, a second and final rendering is performed after parsing the YAML resource file using the additional `values` and `labels` as defined into the YAML resource file.
   * Therefore, it's important that your resource file is converted into a valid YAML file after the first rendering.

{{< figure src="jikkou-template-how-it-work.png" width="50%" class="center" >}}

{{% alert title="Important" color="warning" %}}
You should use `{% raw %}...{% endraw %}` tags to ensure the variables defined into the `template` are not be interpreted during the first rendering.
{{% /alert %}}

## Variables 

Jikkou defines a number of top-level variables that are passed to the template engine.

* `values`: 
  * The values passed into the template through the command-line  `--values-files` and/or `--set-value` arguments 
  * In addition, values can be defined into the `application.conf` file and directly into the template file using the property `template.values`.
  * By default, `values` is empty.


* `labels`: 
  * The labels passed into the template through the command-line argument: `--set-label`. 
  * In addition, labels can be defined into the template file using the property `metadata.labels`.
  * By default, `labels` is empty.


* `system.env`: 
  * This provides access to all environment variables.


* `system.props`: 
  * This provides access to all system properties.

## The Resource Specification File

When using templating the _resource specification file_ may contain the following additional `metadata` and `template` fields:

```yaml
apiVersion: 1 # The jikkou API version (required)
metadata:
  labels: The set of key/value pairs that you can use to describe your specification file (optional)
  annotations: The set of key/value pairs automatically generated by the tool (optional)
template:
  values: The set of key/value pairs to be passed to the template engine (optional)
spec: The specification of resources
```

## Examples

**Template Data File**

Create a file named `values.yaml` with the following content:

```yaml
topic_prefix: "{{ system.env.TOPIC_PREFIX | default('', true) }}"
default_replication_factor: "{{ system.env.DEFAULT_REPLICATION_FACTOR | default(3, true) }}"
locations:
  - fr
  - be
  - de
  - es
  - uk
  - us
```

This file defines all the data (i.e., the variables) that will be passed to the template engine.

**Resource Specification File**

Create a file named `topics.tpl` with the following contents:

```yaml
apiVersion: 1
template:
  values:
    default_min_insync_replicas: "{{ system.env.DEFAULT_REPLICATION_FACTOR | default(3, true) | int | add(-1) }}"
spec:
    config_maps:
    - name: DefaultTopicConfig
      configs:
        retention.ms: 604800000
        min.insync.replicas: "{% raw %}{{ values.default_min_insync_replicas }}{% endraw %}"
    topics:
{% for location in values.locations %}
      - name: "{{ values.topic_prefix}}-iot-events-{{ location }}"
        partitions: {{ values.topic_configs.partitions }}
        replication_factor: {{ values.topic_configs.replication_factor }}
        config_map_refs: [ 'DefaultTopicConfig' ]
{% endfor %}
```

**Command**

```bash
$  TOPIC_PREFIX=local jikkou validate --files topics.tpl --values-files values.yaml 
```
**Output**

```text
apiVersion: "1"
metadata:
  annotations:
    generated: "2022-06-12T00:00:00.000000000Z"
    resource: "/tmp/topics.tpl"
  labels: {}
spec:
  brokers: []
  topics:
  - name: "local-iot-events-fr"
    configs:
      min.insync.replicas: "2"
      retention.ms: 604800000
  - name: "local-iot-events-be"
    configs:
      min.insync.replicas: "2"
      retention.ms: 604800000
  - name: "local-iot-events-de"
    configs:
      min.insync.replicas: "2"
      retention.ms: 604800000
  - name: "local-iot-events-es"
    configs:
      min.insync.replicas: "2"
      retention.ms: 604800000
  - name: "local-iot-events-uk"
    configs:
      min.insync.replicas: "2"
      retention.ms: 604800000
  - name: "local-iot-events-us"
    configs:
      min.insync.replicas: "2"
      retention.ms: 604800000
  quotas: []
```

